<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Share helper</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; padding: 2rem; display: flex; min-height: 100vh; align-items: center; justify-content: center; background: #0b0b0c; color: #f5f5f5; }
    main { max-width: 480px; text-align: center; }
    h1 { font-size: 1.25rem; margin-bottom: 0.75rem; }
    p { margin: 0.25rem 0 0.5rem; font-size: 0.95rem; opacity: 0.8; }
    code { font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <main>
    <h1 id="status">Preparando compartilhamento…</h1>
    <p id="details" class="hidden"></p>
    <p id="error" class="hidden"></p>
    <noscript>
      Este helper precisa de JavaScript habilitado para chamar a Web Share API.
    </noscript>
  </main>
  <script>
    (function () {
      const statusEl = document.getElementById('status');
      const detailsEl = document.getElementById('details');
      const errorEl = document.getElementById('error');

      function setStatus(text) { statusEl.textContent = text; }
      function showDetails(text) { detailsEl.textContent = text; detailsEl.classList.remove('hidden'); }
      function showError(text) { errorEl.textContent = text; errorEl.classList.remove('hidden'); }

      const params = new URLSearchParams(window.location.search);
      const title = params.get('title') || '';
      const text = params.get('text') || '';
      const url = params.get('url') || '';

      if (!navigator.share) {
        setStatus('Compartilhamento não suportado');
        showError('Este navegador não suporta a Web Share API (navigator.share).');
        showDetails('title=' + JSON.stringify(title) + ', text=' + JSON.stringify(text) + ', url=' + JSON.stringify(url));
        return;
      }

      const payload = {};
      if (title) payload.title = title;
      if (text) payload.text = text;
      if (url) payload.url = url;

      if (!payload.title && !payload.text && !payload.url) {
        setStatus('Nada para compartilhar');
        showError('Faltando ?title=, ?text= ou ?url= na query string.');
        return;
      }

      setStatus('Clique em qualquer lugar para compartilhar…');
      showDetails('title=' + JSON.stringify(title) + ', text=' + JSON.stringify(text) + ', url=' + JSON.stringify(url));

      function doShare() {
        navigator.share(payload)
          .then(function () {
            setStatus('Compartilhado com sucesso');
          })
          .catch(function (err) {
            if (err && err.name === 'AbortError') {
              setStatus('Compartilhamento cancelado');
            } else {
              setStatus('Falha ao compartilhar');
              showError('Erro: ' + (err && err.message ? err.message : String(err)));
            }
          })
          .finally(function () {
            document.removeEventListener('click', doShare);
            document.removeEventListener('keydown', doShare);
          });
      }

      // Exige gesto do usuário: clique ou qualquer tecla
      document.addEventListener('click', doShare);
      document.addEventListener('keydown', doShare);
    })();
  </script>
</body>
</html>
